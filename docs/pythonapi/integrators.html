
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>integrators &#8212; UFED for OpenMM  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="input/output" href="io.html" />
    <link rel="prev" title="analysis" href="analysis.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="module-ufedmm.integrators">
<span id="integrators"></span><h1>integrators<a class="headerlink" href="#module-ufedmm.integrators" title="Permalink to this heading">¶</a></h1>
<span class="target" id="module-integrators"></span><dl class="py class">
<dt class="sig sig-object py" id="ufedmm.integrators.AbstractMiddleRespaIntegrator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">ufedmm.integrators.</span></span><span class="sig-name descname"><span class="pre">AbstractMiddleRespaIntegrator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">temperature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_rattles</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scheme</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'VV-Middle'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">respa_loops</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[1]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bath_loops</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">intertwine</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">embodied_force_groups</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">unroll_loops</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ufedmm/integrators.html#AbstractMiddleRespaIntegrator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ufedmm.integrators.AbstractMiddleRespaIntegrator" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#ufedmm.integrators.CustomIntegrator" title="ufedmm.integrators.CustomIntegrator"><code class="xref py py-class docutils literal notranslate"><span class="pre">CustomIntegrator</span></code></a></p>
<p>An abstract class for middle-type, multiple time-scale integrators.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This class is meant for inheritance only and does not actually include thermostatting.
Concrete subclasses are available, such as <a class="reference internal" href="#ufedmm.integrators.MiddleMassiveNHCIntegrator" title="ufedmm.integrators.MiddleMassiveNHCIntegrator"><code class="xref py py-class docutils literal notranslate"><span class="pre">MiddleMassiveNHCIntegrator</span></code></a> and
<a class="reference internal" href="#ufedmm.integrators.GeodesicLangevinIntegrator" title="ufedmm.integrators.GeodesicLangevinIntegrator"><code class="xref py py-class docutils literal notranslate"><span class="pre">GeodesicLangevinIntegrator</span></code></a>, for instance.</p>
</div>
<p>Child classes will differ by the thermostat algorithm, which must be implemented
by overriding the <cite>_bath</cite> method (see the example below).
Temperature is treated as a per-dof parameter so as to allow adiabatic simulations.</p>
<p>The following <a class="reference internal" href="../glossary.html#term-ODE"><span class="xref std std-term">ODE</span></a> system is solved for every degree of freedom in the system,
with possibly <span class="math notranslate nohighlight">\(n_c\)</span> holonomic constraints and with forces possibly split into
<span class="math notranslate nohighlight">\(m\)</span> parts according to their characteristic time scales:</p>
<div class="math notranslate nohighlight">
\[\begin{split}&amp; \dot{r}_i = v_i \\
&amp; \dot{v}_i = \frac{\sum_{k=1}^m F_i^{[k]}}{m_i}
             + \sum_{k=1}^{n_c} \lambda_k \nabla_{r_i} \sigma_k
             + \mathrm{bath}(T_i, v_i) \\
&amp; \sigma_k(\mathbf{r}) = 0\end{split}\]</div>
<p>An approximate solution is obtained by applying the Trotter-Suzuki splitting formula.
In the particular case of two time scales, the default splitting scheme goes as follows:</p>
<div class="math notranslate nohighlight">
\[e^{\Delta t\mathcal{L}} =
    e^{\frac{\Delta t}{2}\mathcal{L}^{[1]}_v}
    \left[
        e^{\frac{\Delta t}{2 n_0}\mathcal{L}^{[0]}_v}
        \left(
            e^{\frac{\Delta t}{2 n_0 n_b}\mathcal{L}_r}
            e^{\frac{\Delta t}{n_0 n_b}\mathcal{L}_\mathrm{bath}}
            e^{\frac{\Delta t}{2 n_0 n_b}\mathcal{L}_r}
        \right)^{n_b}
        e^{\frac{\Delta t}{2 n_0}\mathcal{L}^{[0]}_v}
    \right]^{n_0}
    e^{\frac{\Delta t}{2}\mathcal{L}^{[1]}_v}\]</div>
<p>Each exponential operator is the solution of a particular subsystem of equations.
If <span class="math notranslate nohighlight">\(\mathrm{bath}(T_i, v_i) = 0\)</span>, the scheme above is time-reversible,
measure-preserving, and symplectic. It is referred to as the <code class="docutils literal notranslate"><span class="pre">VV-Middle</span></code> scheme
<span id="id1">[<a class="reference internal" href="../references.html#id28" title="Zhijun Zhang, Xinzijian Liu, Kangyu Yan, Mark E. Tuckerman, and Jian Liu. Unified efficient thermostat scheme for the canonical ensemble with holonomic or isokinetic constraints via molecular dynamics. The Journal of Physical Chemistry A, 123(28):6056–6079, may 2019. doi:10.1021/acs.jpca.9b02771.">5</a>]</span>, where VV stands for Velocity Verlet. An alternative approach
is also available, which is:</p>
<div class="math notranslate nohighlight">
\[e^{\Delta t\mathcal{L}} =
    \left[
        \left(
            e^{\frac{\Delta t}{2 n_0 n_b}\mathcal{L}_r}
            e^{\frac{\Delta t}{n_0 n_b}\mathcal{L}_\mathrm{bath}}
            e^{\frac{\Delta t}{2 n_0 n_b}\mathcal{L}_r}
        \right)^{n_b}
        e^{\frac{\Delta t}{n_0}\mathcal{L}^{[0]}_v}
    \right]^{n_0}
    e^{\Delta t \mathcal{L}^{[1]}_v}\]</div>
<p>This is referred to as the <code class="docutils literal notranslate"><span class="pre">LF-Middle</span></code> scheme <span id="id2">[<a class="reference internal" href="../references.html#id28" title="Zhijun Zhang, Xinzijian Liu, Kangyu Yan, Mark E. Tuckerman, and Jian Liu. Unified efficient thermostat scheme for the canonical ensemble with holonomic or isokinetic constraints via molecular dynamics. The Journal of Physical Chemistry A, 123(28):6056–6079, may 2019. doi:10.1021/acs.jpca.9b02771.">5</a>]</span>, where LF stands for
Leap-Frog. In contrast to the previous scheme, it is not time-reversible. However, in single
time-scale simulations, the two approaches result in equivalent coordinate trajectories,
while the latter provides a velocity trajectory more consistent with the Maxwell-Boltzmann
distribution at the specified temperature <span id="id3">[<a class="reference internal" href="../references.html#id28" title="Zhijun Zhang, Xinzijian Liu, Kangyu Yan, Mark E. Tuckerman, and Jian Liu. Unified efficient thermostat scheme for the canonical ensemble with holonomic or isokinetic constraints via molecular dynamics. The Journal of Physical Chemistry A, 123(28):6056–6079, may 2019. doi:10.1021/acs.jpca.9b02771.">5</a>]</span>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>temperature</strong> (<em>unit.Quantity</em>) – The temperature of the heat bath.</p></li>
<li><p><strong>step_size</strong> (<em>float</em><em> or </em><em>unit.Quantity</em>) – The outer step size with which to integrate the equations of motion.</p></li>
</ul>
</dd>
<dt class="field-even">Keyword Arguments<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>num_rattles</strong> (<em>int</em><em>, </em><em>default=0</em>) – The number of RATTLE computations for geodesic integration <span id="id4">[<a class="reference internal" href="../references.html#id10" title="Benedict Leimkuhler and Charles Matthews. Efficient molecular dynamics using geodesic integration and solvent–solute splitting. Proceedings of the Royal Society A: Mathematical, Physical and Engineering Science, 472(2189):20160138, May 2016. URL: http://rspa.royalsocietypublishing.org/lookup/doi/10.1098/rspa.2016.0138 (visited on 2018-12-31), doi:10.1098/rspa.2016.0138.">6</a>]</span>.
If <code class="docutils literal notranslate"><span class="pre">num_rattles=0</span></code>, then no constraints are considered at all.</p></li>
<li><p><strong>scheme</strong> (<em>str</em><em>, </em><em>default='VV-Middle'</em>) – Which splitting scheme will be used. Valid options are ‘VV-Middle’ and ‘LF-Middle’.</p></li>
<li><p><strong>respa_loops</strong> (<em>list</em><em>(</em><em>int</em><em>)</em><em>, </em><em>default=</em><em>[</em><em>1</em><em>]</em>) – A list of <cite>m</cite> integers, where <cite>respa_loops[k]</cite> determines how many substeps with
force group <cite>k</cite> are internally executed for every step with force group <cite>k+1</cite>.</p></li>
<li><p><strong>bath_loops</strong> (<em>int</em><em>, </em><em>default=1</em>) – The number of iterations of the bath operator per each step at time scale <cite>0</cite>. This
is useful when the bath operator is not exact, but derived from a splitting solution.</p></li>
<li><p><strong>embodied_force_groups</strong> (<em>list</em><em>(</em><em>int</em><em>)</em><em>, </em><em>default=</em><em>[</em><em>]</em>) – A list of indices of force groups. The presence of an index <cite>i</cite> is this list means that
the contribution of force group <cite>i</cite> is embodied in force group <cite>i+1</cite>. Therefore, such
contribution must be properly subtracted during the integration at time scale <cite>i+1</cite>.
This feature requires OpenMM 7.5 or a newer version.</p></li>
<li><p><strong>unroll_loops</strong> (<em>bool</em><em>, </em><em>default=True</em>) – Whether the integrator loops should be unrolled for improving efficiency. Using
<code class="docutils literal notranslate"><span class="pre">unroll_loops=False</span></code> can be useful for printing the integrator steps.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ufedmm</span> <span class="kn">import</span> <span class="n">integrators</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">openmm</span> <span class="kn">import</span> <span class="n">unit</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">MiddleNoseHooverIntegrator</span><span class="p">(</span><span class="n">integrators</span><span class="o">.</span><span class="n">AbstractMiddleRespaIntegrator</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ndof</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">step_size</span><span class="p">,</span> <span class="n">num_rattles</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="n">step_size</span><span class="p">,</span> <span class="n">num_rattles</span><span class="p">,</span> <span class="s1">&#39;VV-Middle&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">kB</span> <span class="o">=</span> <span class="mf">8.3144626E-3</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">kilojoules_per_mole</span><span class="o">/</span><span class="n">unit</span><span class="o">.</span><span class="n">kelvin</span>
<span class="gp">... </span>        <span class="n">gkT</span> <span class="o">=</span> <span class="n">ndof</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">MOLAR_GAS_CONSTANT_R</span><span class="o">*</span><span class="n">temperature</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">addGlobalVariable</span><span class="p">(</span><span class="s1">&#39;gkT&#39;</span><span class="p">,</span> <span class="n">gkT</span><span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">addGlobalVariable</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="n">gkT</span><span class="o">*</span><span class="n">tau</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">addGlobalVariable</span><span class="p">(</span><span class="s1">&#39;v_eta&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">addGlobalVariable</span><span class="p">(</span><span class="s1">&#39;twoK&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">addGlobalVariable</span><span class="p">(</span><span class="s1">&#39;scaling&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">_bath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fraction</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">addComputeSum</span><span class="p">(</span><span class="s1">&#39;twoK&#39;</span><span class="p">,</span> <span class="s1">&#39;m*v*v&#39;</span><span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">addComputeGlobal</span><span class="p">(</span>
<span class="gp">... </span>            <span class="s1">&#39;v_eta&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;v_eta + </span><span class="si">{</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fraction</span><span class="si">}</span><span class="s1">*dt*(twoK - gkT)/Q&#39;</span>
<span class="gp">... </span>        <span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">addComputeGlobal</span><span class="p">(</span><span class="s1">&#39;scaling&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;exp(-</span><span class="si">{</span><span class="n">fraction</span><span class="si">}</span><span class="s1">*dt*v_eta)&#39;</span><span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">addComputePerDof</span><span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;v*scaling&#39;</span><span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">addComputeGlobal</span><span class="p">(</span>
<span class="gp">... </span>            <span class="s1">&#39;v_eta&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;v_eta + </span><span class="si">{</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fraction</span><span class="si">}</span><span class="s1">*dt*(scaling^2*twoK - gkT)/Q&#39;</span>
<span class="gp">... </span>        <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">integrator</span> <span class="o">=</span> <span class="n">MiddleNoseHooverIntegrator</span><span class="p">(</span>
<span class="gp">... </span>    <span class="mi">500</span><span class="p">,</span> <span class="mi">10</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">femtoseconds</span><span class="p">,</span> <span class="mi">300</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">kelvin</span><span class="p">,</span>
<span class="gp">... </span>    <span class="mi">1</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">femtoseconds</span><span class="p">,</span> <span class="n">num_rattles</span><span class="o">=</span><span class="mi">0</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">integrator</span><span class="p">)</span>
<span class="go">Per-dof variables:</span>
<span class="go">  kT</span>
<span class="go">Global variables:</span>
<span class="go">  gkT = 1247.169392722986</span>
<span class="go">  Q = 0.1247169392722986</span>
<span class="go">  v_eta = 0.0</span>
<span class="go">  twoK = 0.0</span>
<span class="go">  scaling = 1.0</span>
<span class="go">Computation steps:</span>
<span class="go">   0: allow forces to update the context state</span>
<span class="go">   1: v &lt;- v + 0.5*dt*f/m</span>
<span class="go">   2: x &lt;- x + 0.5*dt*v</span>
<span class="go">   3: twoK &lt;- sum(m*v*v)</span>
<span class="go">   4: v_eta &lt;- v_eta + 0.5*dt*(twoK - gkT)/Q</span>
<span class="go">   5: scaling &lt;- exp(-1.0*dt*v_eta)</span>
<span class="go">   6: v &lt;- v*scaling</span>
<span class="go">   7: v_eta &lt;- v_eta + 0.5*dt*(scaling^2*twoK - gkT)/Q</span>
<span class="go">   8: x &lt;- x + 0.5*dt*v</span>
<span class="go">   9: v &lt;- v + 0.5*dt*f/m</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="ufedmm.integrators.CustomIntegrator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">ufedmm.integrators.</span></span><span class="sig-name descname"><span class="pre">CustomIntegrator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">temperature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step_size</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ufedmm/integrators.html#CustomIntegrator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ufedmm.integrators.CustomIntegrator" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">CustomIntegrator</span></code></p>
<p>An extension of OpenMM’s <a class="reference external" href="http://docs.openmm.org/latest/api-python/generated/openmm.openmm.CustomIntegrator.html">CustomIntegrator</a> class with an extra per-dof variable named
<cite>temperature</cite>, whose content is the temperature of the heat bath associated to each
degree of freedom. A per-dof temperature is necessary if the extended-space variables
and the physical system are coupled adiabatically to thermostats at different temperatures.
Otherwise, any other OpenMM integrator can be used.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>temperature</strong> (<em>float</em><em> or </em><em>unit.Quantity</em>) – The temperature.</p></li>
<li><p><strong>step_size</strong> (<em>float</em><em> or </em><em>unit.Quantity</em>) – The step size with which to integrate the equations of motion.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="ufedmm.integrators.CustomIntegrator.step">
<span class="sig-name descname"><span class="pre">step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">steps</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ufedmm/integrators.html#CustomIntegrator.step"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ufedmm.integrators.CustomIntegrator.step" title="Permalink to this definition">¶</a></dt>
<dd><p>Advance a simulation through time by taking a series of time steps.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>steps</strong> (<em>int</em>) – the number of time steps to take</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="ufedmm.integrators.GeodesicLangevinIntegrator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">ufedmm.integrators.</span></span><span class="sig-name descname"><span class="pre">GeodesicLangevinIntegrator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">temperature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">friction_coefficient</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_rattles</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scheme</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'LF-Middle'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ufedmm/integrators.html#GeodesicLangevinIntegrator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ufedmm.integrators.GeodesicLangevinIntegrator" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#ufedmm.integrators.AbstractMiddleRespaIntegrator" title="ufedmm.integrators.AbstractMiddleRespaIntegrator"><code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractMiddleRespaIntegrator</span></code></a></p>
<p>A geodesic Langevin integrator <span id="id5">[<a class="reference internal" href="../references.html#id10" title="Benedict Leimkuhler and Charles Matthews. Efficient molecular dynamics using geodesic integration and solvent–solute splitting. Proceedings of the Royal Society A: Mathematical, Physical and Engineering Science, 472(2189):20160138, May 2016. URL: http://rspa.royalsocietypublishing.org/lookup/doi/10.1098/rspa.2016.0138 (visited on 2018-12-31), doi:10.1098/rspa.2016.0138.">6</a>]</span>, which can be integrated by using
either the LF-Middle or the VV-Middle scheme <span id="id6">[<a class="reference internal" href="../references.html#id28" title="Zhijun Zhang, Xinzijian Liu, Kangyu Yan, Mark E. Tuckerman, and Jian Liu. Unified efficient thermostat scheme for the canonical ensemble with holonomic or isokinetic constraints via molecular dynamics. The Journal of Physical Chemistry A, 123(28):6056–6079, may 2019. doi:10.1021/acs.jpca.9b02771.">5</a>]</span>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>temperature</strong> (<em>float</em><em> or </em><em>unit.Quantity</em>) – The temperature.</p></li>
<li><p><strong>friction_coefficient</strong> (<em>float</em><em> or </em><em>unit.Quantity</em>) – The friction coefficient.</p></li>
<li><p><strong>step_size</strong> (<em>float</em><em> or </em><em>unit.Quantity</em>) – The time-step size.</p></li>
</ul>
</dd>
<dt class="field-even">Keyword Arguments<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>num_rattles</strong> (<em>int</em><em>, </em><em>default=1</em>) – The number of RATTLE computations for geodesic integration <span id="id7">[<a class="reference internal" href="../references.html#id10" title="Benedict Leimkuhler and Charles Matthews. Efficient molecular dynamics using geodesic integration and solvent–solute splitting. Proceedings of the Royal Society A: Mathematical, Physical and Engineering Science, 472(2189):20160138, May 2016. URL: http://rspa.royalsocietypublishing.org/lookup/doi/10.1098/rspa.2016.0138 (visited on 2018-12-31), doi:10.1098/rspa.2016.0138.">6</a>]</span>.
If <code class="docutils literal notranslate"><span class="pre">num_rattles=0</span></code>, then no constraints are considered at all.</p></li>
<li><p><strong>scheme</strong> (<em>str</em><em>, </em><em>default='LF-Middle'</em>) – Which splitting scheme will be used. Valid options are ‘VV-Middle’ and ‘LF-Middle’.</p></li>
<li><p><strong>**kwargs</strong> – All other keyword arguments in <a class="reference internal" href="#ufedmm.integrators.AbstractMiddleRespaIntegrator" title="ufedmm.integrators.AbstractMiddleRespaIntegrator"><code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractMiddleRespaIntegrator</span></code></a>.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ufedmm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dt</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">femtoseconds</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">temp</span> <span class="o">=</span> <span class="mi">300</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">kelvin</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gamma</span> <span class="o">=</span> <span class="mi">10</span><span class="o">/</span><span class="n">unit</span><span class="o">.</span><span class="n">picoseconds</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ufedmm</span><span class="o">.</span><span class="n">GeodesicLangevinIntegrator</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">num_rattles</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scheme</span><span class="o">=</span><span class="s1">&#39;VV-Middle&#39;</span><span class="p">)</span>
<span class="go">Per-dof variables:</span>
<span class="go">  kT, x0</span>
<span class="go">Global variables:</span>
<span class="go">  friction = 10.0</span>
<span class="go">Computation steps:</span>
<span class="go">   0: allow forces to update the context state</span>
<span class="go">   1: v &lt;- v + 0.5*dt*f/m</span>
<span class="go">   2: constrain velocities</span>
<span class="go">   3: x &lt;- x + 0.5*dt*v</span>
<span class="go">   4: x0 &lt;- x</span>
<span class="go">   5: constrain positions</span>
<span class="go">   6: v &lt;- v + (x - x0)/(0.5*dt)</span>
<span class="go">   7: constrain velocities</span>
<span class="go">   8: v &lt;- z*v + sqrt((1 - z*z)*kT/m)*gaussian; z = exp(-friction*1.0*dt)</span>
<span class="go">   9: constrain velocities</span>
<span class="go">  10: x &lt;- x + 0.5*dt*v</span>
<span class="go">  11: x0 &lt;- x</span>
<span class="go">  12: constrain positions</span>
<span class="go">  13: v &lt;- v + (x - x0)/(0.5*dt)</span>
<span class="go">  14: constrain velocities</span>
<span class="go">  15: v &lt;- v + 0.5*dt*f/m</span>
<span class="go">  16: constrain velocities</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="ufedmm.integrators.MiddleMassiveGGMTIntegrator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">ufedmm.integrators.</span></span><span class="sig-name descname"><span class="pre">MiddleMassiveGGMTIntegrator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">temperature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_constant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step_size</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ufedmm/integrators.html#MiddleMassiveGGMTIntegrator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ufedmm.integrators.MiddleMassiveGGMTIntegrator" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#ufedmm.integrators.AbstractMiddleRespaIntegrator" title="ufedmm.integrators.AbstractMiddleRespaIntegrator"><code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractMiddleRespaIntegrator</span></code></a></p>
<p>A massive, middle-type Generalized Gaussian Moment Thermostat <span id="id8">[<a class="reference internal" href="../references.html#id19" title="Yi Liu and Mark E. Tuckerman. Generalized Gaussian moment thermostatting: A new continuous dynamical approach to the canonical ensemble. The Journal of Chemical Physics, 112(4):1685–1700, January 2000. URL: http://aip.scitation.org/doi/10.1063/1.480769 (visited on 2019-06-13), doi:10.1063/1.480769.">7</a>]</span>
solver with optional multiple time-scale integration via RESPA.</p>
<p>To enable RESPA, the forces in OpenMM system must be split into distinct force
groups and the keyword <code class="docutils literal notranslate"><span class="pre">respa_loop</span></code> (see below) must be a list with multiple entries.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>temperature</strong> (<em>float</em><em> or </em><em>unit.Quantity</em>) – The temperature.</p></li>
<li><p><strong>time_constant</strong> (<em>float</em><em> or </em><em>unit.Quantity</em>) – The characteristic time constant.</p></li>
<li><p><strong>step_size</strong> (<em>float</em><em> or </em><em>unit.Quantity</em>) – The time-step size.</p></li>
</ul>
</dd>
<dt class="field-even">Keyword Arguments<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>**kwargs</strong> – All keyword arguments in <a class="reference internal" href="#ufedmm.integrators.AbstractMiddleRespaIntegrator" title="ufedmm.integrators.AbstractMiddleRespaIntegrator"><code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractMiddleRespaIntegrator</span></code></a>, except <code class="docutils literal notranslate"><span class="pre">num_rattles</span></code>.</p>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ufedmm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">temp</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">dt</span> <span class="o">=</span> <span class="mi">300</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">kelvin</span><span class="p">,</span> <span class="mi">10</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">femtoseconds</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">femtoseconds</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">integrator</span> <span class="o">=</span> <span class="n">ufedmm</span><span class="o">.</span><span class="n">MiddleMassiveGGMTIntegrator</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">integrator</span><span class="p">)</span>
<span class="go">Per-dof variables:</span>
<span class="go">  kT, Q1, Q2, v1, v2</span>
<span class="go">Computation steps:</span>
<span class="go">   0: allow forces to update the context state</span>
<span class="go">   1: v &lt;- v + 0.5*dt*f/m</span>
<span class="go">   2: x &lt;- x + 0.5*dt*v</span>
<span class="go">   3: v1 &lt;- v1 + 0.5*dt*(m*v^2 - kT)/Q1</span>
<span class="go">   4: v2 &lt;- v2 + 0.5*dt*((m*v^2)^2/3 - kT^2)/Q2</span>
<span class="go">   5: v &lt;- v*exp(-1.0*dt*(v1 + kT*v2))/sqrt(1 + 2.0*dt*m*v^2*v2/3)</span>
<span class="go">   6: v1 &lt;- v1 + 0.5*dt*(m*v^2 - kT)/Q1</span>
<span class="go">   7: v2 &lt;- v2 + 0.5*dt*((m*v^2)^2/3 - kT^2)/Q2</span>
<span class="go">   8: x &lt;- x + 0.5*dt*v</span>
<span class="go">   9: v &lt;- v + 0.5*dt*f/m</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="ufedmm.integrators.MiddleMassiveNHCIntegrator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">ufedmm.integrators.</span></span><span class="sig-name descname"><span class="pre">MiddleMassiveNHCIntegrator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">temperature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_constant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nchain</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">track_energy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ufedmm/integrators.html#MiddleMassiveNHCIntegrator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ufedmm.integrators.MiddleMassiveNHCIntegrator" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#ufedmm.integrators.AbstractMiddleRespaIntegrator" title="ufedmm.integrators.AbstractMiddleRespaIntegrator"><code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractMiddleRespaIntegrator</span></code></a></p>
<p>A massive, middle-type Nose-Hoover Chain Thermostat solver <span id="id9">[<a class="reference internal" href="../references.html#id3" title="Glenn J. Martyna, Michael L. Klein, and Mark Tuckerman. Nosé-Hoover chains: The canonical ensemble via continuous dynamics. The Journal of Chemical Physics, 97(4):2635–2643, August 1992. URL: https://doi.org/10.1063%2F1.463940, doi:10.1063/1.463940.">8</a>]</span>
with optional multiple time-scale integration via RESPA.</p>
<p>To enable RESPA, the forces in OpenMM system must be split into distinct force
groups and the keyword <code class="docutils literal notranslate"><span class="pre">respa_loop</span></code> (see below) must be a list with multiple entries.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>temperature</strong> (<em>float</em><em> or </em><em>unit.Quantity</em>) – The temperature.</p></li>
<li><p><strong>time_constant</strong> (<em>float</em><em> or </em><em>unit.Quantity</em>) – The characteristic time constant.</p></li>
<li><p><strong>step_size</strong> (<em>float</em><em> or </em><em>unit.Quantity</em>) – The time-step size.</p></li>
</ul>
</dd>
<dt class="field-even">Keyword Arguments<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>nchain</strong> (<em>int</em><em>, </em><em>default=2</em>) – The number of thermostats in each Nose-Hoover chain.</p></li>
<li><p><strong>track_energy</strong> (<em>bool</em><em>, </em><em>default=False</em>) – Whether to track the thermostat energy term.</p></li>
<li><p><strong>**kwargs</strong> – All keyword arguments in <a class="reference internal" href="#ufedmm.integrators.AbstractMiddleRespaIntegrator" title="ufedmm.integrators.AbstractMiddleRespaIntegrator"><code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractMiddleRespaIntegrator</span></code></a>, except <code class="docutils literal notranslate"><span class="pre">num_rattles</span></code>.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ufedmm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">temp</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">dt</span> <span class="o">=</span> <span class="mi">300</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">kelvin</span><span class="p">,</span> <span class="mi">10</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">femtoseconds</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">femtoseconds</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">integrator</span> <span class="o">=</span> <span class="n">ufedmm</span><span class="o">.</span><span class="n">MiddleMassiveNHCIntegrator</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">temp</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">respa_loops</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">unroll_loops</span><span class="o">=</span><span class="kc">False</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">integrator</span><span class="p">)</span>
<span class="go">Per-dof variables:</span>
<span class="go">  kT, Q, v1, v2</span>
<span class="go">Global variables:</span>
<span class="go">  irespa0 = 0.0</span>
<span class="go">Computation steps:</span>
<span class="go">   0: allow forces to update the context state</span>
<span class="go">   1: v &lt;- v + 0.5*dt*f1/m</span>
<span class="go">   2: irespa0 &lt;- 0</span>
<span class="go">   3: while (irespa0 &lt; 3.5):</span>
<span class="go">   4:    v &lt;- v + 0.125*dt*f0/m</span>
<span class="go">   5:    x &lt;- x + 0.125*dt*v</span>
<span class="go">   6:    v2 &lt;- v2 + 0.125*dt*(Q*v1^2 - kT)/Q</span>
<span class="go">   7:    v1 &lt;- (v1*z + 0.125*dt*(m*v^2 - kT)/Q)*z; z=exp(-0.0625*dt*v2)</span>
<span class="go">   8:    v &lt;- v*exp(-0.25*dt*v1)</span>
<span class="go">   9:    v1 &lt;- (v1*z + 0.125*dt*(m*v^2 - kT)/Q)*z; z=exp(-0.0625*dt*v2)</span>
<span class="go">  10:    v2 &lt;- v2 + 0.125*dt*(Q*v1^2 - kT)/Q</span>
<span class="go">  11:    x &lt;- x + 0.125*dt*v</span>
<span class="go">  12:    v &lt;- v + 0.125*dt*f0/m</span>
<span class="go">  13:    irespa0 &lt;- irespa0 + 1</span>
<span class="go">  14: end</span>
<span class="go">  15: v &lt;- v + 0.5*dt*f1/m</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="ufedmm.integrators.RegulatedNHLIntegrator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">ufedmm.integrators.</span></span><span class="sig-name descname"><span class="pre">RegulatedNHLIntegrator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">temperature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_constant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">friction_coefficient</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">regulation_parameter</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">semi_regulated</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">split_ornstein_uhlenbeck</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ufedmm/integrators.html#RegulatedNHLIntegrator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ufedmm.integrators.RegulatedNHLIntegrator" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#ufedmm.integrators.AbstractMiddleRespaIntegrator" title="ufedmm.integrators.AbstractMiddleRespaIntegrator"><code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractMiddleRespaIntegrator</span></code></a></p>
<p>A regulated version of the massive Nose-Hoover-Langevin <span id="id10">[<a class="reference internal" href="../references.html#id23" title="Alex A. Samoletov, Carl P. Dettmann, and Mark A. J. Chaplain. Thermostats for \textquotedblleft slow\textquotedblright  configurational modes. Journal of Statistical Physics, 128(6):1321–1336, jul 2007. doi:10.1007/s10955-007-9365-2.">9</a>, <a class="reference internal" href="../references.html#id24" title="Ben Leimkuhler, Emad Noorizadeh, and Florian Theil. A gentle stochastic thermostat for molecular dynamics. Journal of Statistical Physics, 135(2):261–277, apr 2009. doi:10.1007/s10955-009-9734-0.">10</a>]</span>
method. Regulation means that the system Hamiltonian is modified so that velocities remain
below a temperature-dependent limit. This is closely related to the SIN(R) method
<span id="id11">[<a class="reference internal" href="../references.html#id8" title="Benedict Leimkuhler and Charles Matthews. Robust and efficient configurational molecular sampling via Langevin dynamics. The Journal of Chemical Physics, 138(17):174102, May 2013. URL: http://aip.scitation.org/doi/10.1063/1.4802990 (visited on 2018-11-16), doi:10.1063/1.4802990.">11</a>]</span> and allows multiple time-scale integration with very large outer time
steps, without resonance.</p>
<p>The following <a class="reference internal" href="../glossary.html#term-SDE"><span class="xref std std-term">SDE</span></a> system is solved for every degree of freedom in the system:</p>
<div class="math notranslate nohighlight">
\[\begin{split}&amp; dr_i = v_i dt \\
&amp; dp_i = F_i dt - v_{\eta_i} m_i v_i dt \\
&amp; dv_{\eta_i} = \frac{1}{Q}\left(\frac{n+1}{n} m_i v_i^2 - k_B T\right) dt
        - \gamma v_{\eta_i} dt + \sqrt{\frac{2\gamma k_B T}{Q}} dW_i,\end{split}\]</div>
<p>where:</p>
<div class="math notranslate nohighlight">
\[v_i = c_i \tanh\left(\frac{p_i}{m_i c_i}\right).\]</div>
<p>Here, <span class="math notranslate nohighlight">\(n\)</span> is the regulation parameter and <span class="math notranslate nohighlight">\(c_i = \sqrt{\frac{n k T}{m_i}}\)</span> is
the maximum speed for degree of freedom <cite>i</cite>. The inertial parameter <span class="math notranslate nohighlight">\(Q\)</span> is defined as
<span class="math notranslate nohighlight">\(Q = n k_B T \tau^2\)</span>, with <span class="math notranslate nohighlight">\(\tau\)</span> being a relaxation time <span id="id12">[<a class="reference internal" href="../references.html#id7" title="M. Tuckerman, B. J. Berne, and G. J. Martyna. Reversible multiple time scale molecular dynamics. The Journal of Chemical Physics, 97(3):1990–2001, August 1992. URL: http://aip.scitation.org/doi/10.1063/1.463137 (visited on 2018-11-14), doi:10.1063/1.463137.">12</a>]</span>.
An approximate solution is obtained by applying the Trotter-Suzuki splitting formula:</p>
<div class="math notranslate nohighlight">
\[e^{\Delta t\mathcal{L}} =
e^{\frac{\Delta t}{2}\mathcal{L}^1_p}
\left[e^{\frac{\delta t}{2}\mathcal{L}^0_p}
e^{\frac{\delta t}{2}\mathcal{L}_r}
e^{\delta t \mathcal{L}_\mathrm{bath}}
e^{\frac{\delta t}{2}\mathcal{L}_r}
e^{\frac{\delta t}{2}\mathcal{L}^0_p}\right]^m
e^{\frac{\Delta t}{2}\mathcal{L}^1_p}\]</div>
<p>where <span class="math notranslate nohighlight">\(\delta t = \frac{\Delta t}{m}\)</span>. Each exponential operator above is the solution
of a differential equation.</p>
<p>The exact solution for the physical-system part is:</p>
<div class="math notranslate nohighlight">
\[r_i(t) = r_i^0 + c_i \mathrm{tanh}\left(\frac{p_i}{m c_i}\right) t\]</div>
<div class="math notranslate nohighlight">
\[p_i(t) = p_i^0 + F_i t\]</div>
<p>The bath propagator is further split as:</p>
<div class="math notranslate nohighlight">
\[e^{\delta t \mathcal{L}_\mathrm{bath}} =
e^{\frac{\delta t}{2m}\mathcal{L}_B}
e^{\frac{\delta t}{2m}\mathcal{L}_S}
e^{\frac{\delta t}{m}\mathcal{L}_O}
e^{\frac{\delta t}{2m}\mathcal{L}_S}
e^{\frac{\delta t}{2m}\mathcal{L}_B}\]</div>
<p>Part ‘B’ is a boost, whose solution is:</p>
<div class="math notranslate nohighlight">
\[v_{\eta_i}(t) = v_{\eta_i}^0 +
                 \frac{1}{Q}\left(\frac{n+1}{n} m_i v_i^2 - k_B T\right) t\]</div>
<p>Part ‘S’ is a scaling, whose solution is:</p>
<div class="math notranslate nohighlight">
\[p_i(t) = m_i c_i \mathrm{arcsinh}\left[
            \sinh\left(\frac{p_i^0}{m_i c_i}\right) e^{- v_{\eta_i} t}
         \right]\]</div>
<p>Part ‘O’ is an Ornstein–Uhlenbeck process, whose solution is:</p>
<div class="math notranslate nohighlight">
\[v_{\eta_i}(t) = v_{\eta_i}^0 e^{-\gamma t}
           + \sqrt{\frac{k_B T}{Q}(1-e^{-2\gamma t})} R_N\]</div>
<p>where <span class="math notranslate nohighlight">\(R_N\)</span> is a normally distributed random number.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>step_size</strong> (<em>float</em><em> or </em><em>unit.Quantity</em>) – The outer step size with which to integrate the equations of motion.</p></li>
<li><p><strong>loops</strong> (<em>int</em>) – The number of internal substeps at each time step.</p></li>
<li><p><strong>temperature</strong> (<em>unit.Quantity</em>) – The temperature of the heat bath.</p></li>
<li><p><strong>time_scale</strong> (<em>unit.Quantity</em><em> (</em><em>time</em><em>)</em>) – The relaxation time (<span class="math notranslate nohighlight">\(\tau\)</span>) of the Nose-Hoover thermostat.</p></li>
<li><p><strong>friction_coefficient</strong> (<em>unit.Quantity</em><em> (</em><em>1/time</em><em>)</em>) – The friction coefficient (<span class="math notranslate nohighlight">\(\gamma\)</span>) of the Langevin thermostat.</p></li>
<li><p><strong>regulation_parameter</strong> (<em>int</em><em> or </em><em>float</em>) – The regulation parameter n.</p></li>
</ul>
</dd>
<dt class="field-even">Keyword Arguments<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>semi_regulated</strong> (<em>bool</em><em>, </em><em>default=True</em>) – Whether to use the semi-regulated NHL version of the method instead of its
fully-regulated version.</p></li>
<li><p><strong>split_ornstein_uhlenbeck</strong> (<em>bool</em><em>, </em><em>default=True</em>) – Whether to split the drifted Ornstein-Uhlenbeck operator.</p></li>
<li><p><strong>**kwargs</strong> – All keyword arguments in <a class="reference internal" href="#ufedmm.integrators.AbstractMiddleRespaIntegrator" title="ufedmm.integrators.AbstractMiddleRespaIntegrator"><code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractMiddleRespaIntegrator</span></code></a>, except <code class="docutils literal notranslate"><span class="pre">num_rattles</span></code>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="ufedmm.integrators.add_inner_nonbonded_force">
<span class="sig-prename descclassname"><span class="pre">ufedmm.integrators.</span></span><span class="sig-name descname"><span class="pre">add_inner_nonbonded_force</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">system</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inner_switch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">inner_cutoff</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_group_index</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ufedmm/integrators.html#add_inner_nonbonded_force"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#ufedmm.integrators.add_inner_nonbonded_force" title="Permalink to this definition">¶</a></dt>
<dd><p>To a given OpenMM <a class="reference external" href="http://docs.openmm.org/latest/api-python/generated/openmm.openmm.System.html">System</a> containing a <a class="reference external" href="http://docs.openmm.org/latest/api-python/generated/openmm.openmm.NonbondedForce.html">NonbondedForce</a> object, this function adds a new force
group with the purpose of performing multiple time-scale integration according to the RESPA2
splitting scheme of Morrone, Zhou, and Berne <span id="id13">[<a class="reference internal" href="../references.html#id29" title="Joseph A. Morrone, Ruhong Zhou, and B. J. Berne. Molecular dynamics with multiple time scales: how to avoid pitfalls. Journal of Chemical Theory and Computation, 6(6):1798–1804, may 2010. doi:10.1021/ct100054k.">13</a>]</span>. Besides, it assigns the
provided <cite>force_group_index</cite> to this new group and <cite>force_group_index+1</cite> to the original
<a class="reference external" href="http://docs.openmm.org/latest/api-python/generated/openmm.openmm.NonbondedForce.html">NonbondedForce</a>. When used in any instance of <a class="reference internal" href="#ufedmm.integrators.AbstractMiddleRespaIntegrator" title="ufedmm.integrators.AbstractMiddleRespaIntegrator"><code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractMiddleRespaIntegrator</span></code></a>, the new
force group must be identified as being embodied by the <a class="reference external" href="http://docs.openmm.org/latest/api-python/generated/openmm.openmm.NonbondedForce.html">NonbondedForce</a> as opposed to being
complimentary to it.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>system</strong> (<em>openmm.System</em>) – The system the inner force will be added to, which must contain a <a class="reference external" href="http://docs.openmm.org/latest/api-python/generated/openmm.openmm.NonbondedForce.html">NonbondedForce</a>.</p></li>
<li><p><strong>inner_switch</strong> (<em>float</em><em> or </em><em>unit.Quantity</em>) – The inner switching distance, where the interaction of an atom pair begins to switch
off to zero.</p></li>
<li><p><strong>inner_cutoff</strong> (<em>float</em><em> or </em><em>unit.Quantity</em>) – The inner cutoff distance, where the interaction of an atom pairs completely switches
off.</p></li>
<li><p><strong>force_group_index</strong> (<em>int</em>) – The force group the new interactions will belong to. The old <a class="reference external" href="http://docs.openmm.org/latest/api-python/generated/openmm.openmm.NonbondedForce.html">NonbondedForce</a> will be
automatically assigned to <cite>force_group_index+1</cite>.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ufedmm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">openmm</span> <span class="kn">import</span> <span class="n">unit</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dt</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">femtoseconds</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">temp</span> <span class="o">=</span> <span class="mi">300</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">kelvin</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tau</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">femtoseconds</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gamma</span> <span class="o">=</span> <span class="mi">10</span><span class="o">/</span><span class="n">unit</span><span class="o">.</span><span class="n">picoseconds</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">ufedmm</span><span class="o">.</span><span class="n">AlanineDipeptideModel</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ufedmm</span><span class="o">.</span><span class="n">add_inner_nonbonded_force</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">system</span><span class="p">,</span> <span class="mi">5</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">angstroms</span><span class="p">,</span> <span class="mi">8</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">angstroms</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">UFED for OpenMM</a></h1>











<h3><a href="../index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../readme.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Python API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="ufedmm.html">ufedmm</a></li>
<li class="toctree-l2"><a class="reference internal" href="cvlib.html">collective variable library</a></li>
<li class="toctree-l2"><a class="reference internal" href="analysis.html">analysis</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">integrators</a></li>
<li class="toctree-l2"><a class="reference internal" href="io.html">input/output</a></li>
<li class="toctree-l2"><a class="reference internal" href="testmodels.html">testmodels</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">Bibliography</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Charlles Abreu. Project structure based on the Computational Molecular Science Python Cookiecutter version 1.0.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 6.1.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../_sources/pythonapi/integrators.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>